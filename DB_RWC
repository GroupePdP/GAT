

/*DROP TABLE stade CASCADE;
DROP TABLE match CASCADE;
DROP TABLE joue CASCADE;
DROP TABLE nation CASCADE;
DROP SEQUENCE seqmatch, seqnat, seqstad;*/


CREATE SEQUENCE seqnat;

CREATE TABLE nation (
  nat_id INTEGER PRIMARY KEY DEFAULT nextval('seqnat'),
  nat_nom VARCHAR(20) NOT NULL,
  nat_abr VARCHAR(3) NOT NULL,
  nat_poule CHAR(1) NOT NULL CHECK (nat_poule IN ('A','B','C','D'))
);

CREATE SEQUENCE seqstad;

CREATE TABLE stade (
       sta_id INTEGER PRIMARY KEY DEFAULT nextval('seqstad'),
       sta_nom VARCHAR(40),
       sta_ville VARCHAR(20),
       sta_cap INTEGER);

CREATE SEQUENCE seqmatch;

CREATE TABLE match (
       mat_id INTEGER PRIMARY KEY DEFAULT nextval('seqmatch'),
       mat_date DATE NOT NULL,
       mat_stade INTEGER REFERENCES stade(sta_id)
);

CREATE TABLE joue (
       mat_id INTEGER REFERENCES match(mat_id),
       nat_id INTEGER REFERENCES nation(nat_id),
       nat_essai INTEGER,
       nat_trans INTEGER,
       nat_penal INTEGER,
       nat_drop INTEGER,
       PRIMARY KEY (mat_id, nat_id)
);





INSERT INTO nation VALUES   
       (DEFAULT,'Nouvelle-Zelande','N-Z','A'),  -- 1
       (DEFAULT,'France','FRA','A'),  	-- 2
       (DEFAULT,'Tonga','TON','A'),		-- 3
       (DEFAULT,'Japon','JAP','A'),		-- 4
       (DEFAULT,'Canada','CAN','A'),		-- 5
       (DEFAULT,'Angleterre','ANG','B'),	-- 6
       (DEFAULT,'Ecosse','ECO','B'),		-- 7
       (DEFAULT,'Argentine','ARG','B'),		-- 8
       (DEFAULT,'GÃ©orgie','GEO','B'),		-- 9
       (DEFAULT,'Roumanie','ROU','B'),		--10
       (DEFAULT,'Irlande','IRL','C'),		--11
       (DEFAULT,'Australie','AUS','C'),		--12
       (DEFAULT,'Italie','ITA','C'),		--13
       (DEFAULT,'Etats-Unis','E-U','C'),	--14
       (DEFAULT,'Russie','RUS','C'),		--15
       (DEFAULT,'Pays de Galles','GAL','D'),	--16
       (DEFAULT,'Namibie','NAM','D'),		--17
       (DEFAULT,'Samoa','SAM','D'),		--18
       (DEFAULT,'Afrique du Sud','AFS','D'),	--19
       (DEFAULT,'Fidji','FID','D');		--20

INSERT INTO stade values 
       (DEFAULT, 'Rugby Park Stadium', 'Invercargill', 20000),		-- 1
       (DEFAULT, 'Carisbrook Stadium', 'Dunedin', 29000),		-- 2
       (DEFAULT, 'Trafalgar Park', 'Nelson', 20080),			-- 3
       (DEFAULT, 'Wellington Regional Stadium', 'Wellington', 40000),	-- 4
       (DEFAULT, 'Arena Manawatu', 'Palmerston North', 18300),		-- 5
       (DEFAULT, 'Mc Lean Park', 'Napier', 18700),			-- 6
       (DEFAULT, 'Rotorua International Stadium', 'Rotorua', 30000),	-- 7
       (DEFAULT, 'Waikato Stadium', 'Hamilton', 30800),			-- 8
       (DEFAULT, 'Eden Park', 'Auckland', 60000),			-- 9
       (DEFAULT, 'North Harbourg Stadium', 'Auckland', 30000),		--10
       (DEFAULT, 'Northland Events Center', 'Whangarei', 20000),	--11
       (DEFAULT, 'Stadium Taranaki', 'New Plymouth', 25000);            --12






-- POULE A


-- ven 09/09/2011 Auckland   NOUVELLE-ZELANDE   - TONGA         41 - 10
INSERT INTO match VALUES (DEFAULT, '09-09-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 1, 6, 4, 1, 0),
       (currval('seqmatch'), 3, 1, 1, 1, 0);

-- ven 10/09/2011 Auckland   FRANCE   - JAPON         47 - 21
INSERT INTO match VALUES (DEFAULT, '10-09-2011', 10);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 2, 6, 4, 3, 0),
       (currval('seqmatch'), 4, 2, 1, 3, 0);

-- ven 14/09/2011 Whangarei   TONGA   - CANADA         20 - 25
INSERT INTO match VALUES (DEFAULT, '14-09-2011', 11);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 3, 2, 2, 2, 0),
       (currval('seqmatch'), 5, 3, 2, 2, 0);

-- ven 16/09/2011 Hamilton   NOUVELLE-ZELANDE	- JAPON		83 - 7
INSERT INTO match values (DEFAULT, '16-09-2011', 8);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 1, 13, 9, 0, 0),
       (currval('seqmatch'), 4, 1, 1, 0, 0);

-- dim 18/09/2011 Napier     FRANCE 		- CANADA        46 - 19
INSERT INTO match values (DEFAULT, '18-09-2011', 6);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 2, 4, 4, 5, 1),
       (currval('seqmatch'), 5, 1, 1, 2, 2);

-- mer 21/09/2011 Whangarei  TONGA 		- JAPON        	31 - 18
INSERT INTO match values (DEFAULT, '21-09-2011', 11);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 3, 3, 2, 4, 0),
       (currval('seqmatch'), 4, 3, 0, 1, 0);

-- sam 24/09/2011 Auckland   NOUVELLE-ZELANDE 	- FRANCE        37 - 17
INSERT INTO match values (DEFAULT, '24-09-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 1, 5, 3, 1, 1),
       (currval('seqmatch'), 2, 2, 2, 1, 0);

-- mar 27/09/2011 Napier     CANADA 		- JAPON        	23 - 23
INSERT INTO match values (DEFAULT, '27-09-2011', 6);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 5, 3, 1, 2, 0),
       (currval('seqmatch'), 4, 2, 2, 3, 0);

-- sam 01/10/2011 Wellington FRANCE 		- TONGA        	14 - 19
INSERT INTO match values (DEFAULT, '01-10-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 2, 1, 0, 3, 0),
       (currval('seqmatch'), 3, 1, 1, 4, 0);

-- dim 02/10/2011 Wellington NOUVELLE-ZELANDE 	- CANADA        79 - 15 
INSERT INTO match values (DEFAULT, '02-10-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 1, 12, 8, 1, 0),
       (currval('seqmatch'), 5, 2, 1, 1, 0);




--POULE B

-- sam 10/09/2011       Invercargill      ECOSSE         - ROUMANIE      34 - 24
INSERT INTO match VALUES (DEFAULT, '10-09-2011', 1);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 7, 4, 1, 4, 0),
       (currval('seqmatch'), 10, 2, 1, 4, 0);
-- sam 10/09/2011       Dunedin           ARGENTINE      - ANGLETERRE     9 - 13
INSERT INTO match VALUES (DEFAULT, '10-09-2011', 2);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 8, 0, 0, 3, 0),
       (currval('seqmatch'), 6, 1, 1, 2, 0);
-- mer 14/09/2011       Dunedin	          ECOSSE         - GEORGIE       15 - 6
INSERT INTO match VALUES (DEFAULT, '14-09-2011', 1);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 7, 0, 0, 4, 1),
       (currval('seqmatch'), 9, 0, 0, 2, 0);
-- sam 17/09/2011       Invercargill      ARGENTINE      - ROUMANIE      43 - 8
INSERT INTO match VALUES (DEFAULT, '17-09-2011', 1);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 8, 6, 5, 1, 0),
       (currval('seqmatch'), 10, 1, 0, 1, 0);
-- dim 18/09/2011       Dunedin           ANGLETERRE     - GEORGIE       41 - 10
INSERT INTO match VALUES (DEFAULT, '18-09-2011', 2);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 6, 6, 4, 1, 0),
       (currval('seqmatch'), 9, 1, 1, 1, 0);
-- sam 24/09/2011       Dunedin           ANGLETERRE     - ROUMANIE      67 - 3
INSERT INTO match VALUES (DEFAULT, '24-09-2011', 2);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 6, 10, 7, 1, 0),
       (currval('seqmatch'), 10, 0, 0, 1, 0);
-- dim 25/09/2011       Wellington        ARGENTINE      - ECOSSE        13 - 12
INSERT INTO match VALUES (DEFAULT, '25-09-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 8, 1, 1, 2, 0),
       (currval('seqmatch'), 7, 0, 0, 2, 2);
-- mer 28/09/2011       Palmerston North  GEORGIE        - ROUMANIE      25 - 9
INSERT INTO match VALUES (DEFAULT, '28-09-2011', 5);
INSERT INTO joue VALUES 
       (currval('seqmatch'),9, 1, 1, 6, 0),
       (currval('seqmatch'), 10, 0, 0, 3, 0);
-- sam 01/10/2011       Auckland          ANGLETERRE     - ECOSSE        16 - 12
INSERT INTO match VALUES (DEFAULT, '01-10-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 6, 1, 1, 2, 1),
       (currval('seqmatch'), 7, 0, 0, 3, 1);
-- dim 02/10/2011       Palmerston North  ARGENTINE      - GEORGIE       25 - 7 
INSERT INTO match VALUES (DEFAULT, '02-10-2011', 5);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 8, 3, 2, 2, 0),
       (currval('seqmatch'), 9, 1, 1, 0, 0);




-- POULE C
-- dim 11/09/2011 	North Shore City  AUSTRALIE 	 - ITALIE        32 - 6
INSERT INTO match values(DEFAULT, '11-09-2011', 10);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 12, 4, 3, 2, 0),
       (currval('seqmatch'), 13, 0, 0, 2, 0);
-- dim 11/09/2011  	New Plymouth 	  IRLANDE 	 - ETATS-UNIS    22 - 10
INSERT INTO match values(DEFAULT, '11-09-2011', 12);
INSERT INTO joue VALUES
       (currval('seqmatch'), 11, 3, 2, 1, 0),
       (currval('seqmatch'), 14, 1, 1, 1, 0);
-- jeu 15/09/2011 	New Plymouth 	  RUSSIE 	 - ETATS-UNIS     6 - 13
INSERT INTO match values(DEFAULT, '15-09-2011', 12);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 15, 0, 0, 2, 0),
       (currval('seqmatch'), 14, 1, 1, 2, 0);
-- sam 17/09/2011 	Auckland 	  AUSTRALIE 	 - IRLANDE        6 - 15
INSERT INTO match values(DEFAULT, '17-09-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 12, 0, 0, 2, 0),
       (currval('seqmatch'), 11, 0, 0, 4, 1);
-- mar 20/09/2011 	Nelson 	       	  ITALIE 	 - RUSSIE        53 - 17
INSERT INTO match values(DEFAULT, '20-09-2011', 3);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 13, 9, 4, 0, 0),
       (currval('seqmatch'), 15, 3, 1, 0, 0);
-- ven 23/09/2011 	Wellington 	  AUSTRALIE 	 - ETATS-UNIS    67 - 5
INSERT INTO match values(DEFAULT, '23-09-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 12, 11, 6, 0, 0),
       (currval('seqmatch'), 14, 1, 0, 0, 0);
-- dim 25/09/2011 	Rotorua 	  IRLANDE 	 - RUSSIE        62 - 12
INSERT INTO match values(DEFAULT, '25-09-2011', 7);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 11, 9, 7, 1, 0),
       (currval('seqmatch'), 15, 2, 1, 0, 0);
-- mar 27/09/2011 	Nelson 	          ITALIE 	 - ETATS-UNIS    27 - 10
INSERT INTO match values(DEFAULT, '27-09-2011', 3);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 13, 4, 2, 1, 0),
       (currval('seqmatch'), 14, 1, 1, 1, 0);
-- sam 01/10/2011 	Nelson 	          AUSTRALIE 	 - RUSSIE        68 - 22
INSERT INTO match values(DEFAULT, '01-10-2011', 3);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 12, 10, 9, 0, 0),
       (currval('seqmatch'), 15, 3, 2, 0, 1);
-- dim 02/10/2011 	Dunedin 	  IRLANDE 	 - ITALIE        36 - 6 
INSERT INTO match values(DEFAULT, '02-10-2011', 2);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 11, 3, 3, 5, 0),
       (currval('seqmatch'), 13, 0, 0, 2, 0);




-- POULE D

-- sam 10/09/2011 	Rotorua 	  FIDJI 	 - NAMIBIE       49 - 25
INSERT INTO match VALUES (DEFAULT, '10-09-2011', 7);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 20, 6, 5, 3, 0),
       (currval('seqmatch'), 17, 2, 0, 2, 3);

-- dim 11/09/2011 	Wellington 	  AFRIQUE DU SUD - GALLES        17 - 16
INSERT INTO match VALUES (DEFAULT, '11-09-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 19, 2, 2, 1, 0),
       (currval('seqmatch'), 16, 1, 1, 3, 0);

-- mer 14/09/2011 	Rotorua 	  SAMOA 	 - NAMIBIE       49 - 12
INSERT INTO match VALUES (DEFAULT, '14-09-2011', 7);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 18, 6, 5, 3, 0),
       (currval('seqmatch'), 17, 2, 1, 0, 0);

-- sam 17/09/2011 	Wellington 	  AFRIQUE DU SUD - FIDJI         49 - 3
INSERT INTO match VALUES (DEFAULT, '17-09-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 19, 6, 5, 3, 0),
       (currval('seqmatch'), 20, 0, 0, 1, 0);

-- dim 18/09/2011 	Hamilton 	  GALLES 	 - SAMOA         17 - 10
INSERT INTO match VALUES (DEFAULT, '18-09-2011', 8);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 16, 1, 0, 4, 0),
       (currval('seqmatch'), 18, 1, 1, 1, 0);

-- jeu 22/09/2011       North Harbour Stadium    AFRIQUE DU SUD - NAMIBIE       87 - 0
INSERT INTO match VALUES (DEFAULT, '22-09-2011', 10);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 19, 12, 12, 1, 0),
       (currval('seqmatch'), 17, 0, 0, 0, 0);

-- dim 25/09/2011 	Auckland 	  FIDJI 	 - SAMOA          7 - 27
INSERT INTO match VALUES (DEFAULT, '25-09-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 20, 1, 1, 0, 0),
       (currval('seqmatch'), 18, 2, 1, 4, 1);

-- lun 26/09/2011 	New Plymouth 	  GALLES 	 - NAMIBIE       81 - 7
INSERT INTO match VALUES (DEFAULT, '26-09-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 16, 12, 9, 1, 0),
       (currval('seqmatch'), 17, 1, 1, 0, 0);

-- ven 30/09/2011 	North Harbour Stadium 	  AFRIQUE DU SUD - SAMOA         13 - 5
INSERT INTO match VALUES (DEFAULT, '30-09-2011', 10);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 19, 1, 1, 2, 0),
       (currval('seqmatch'), 18, 1, 0, 0, 0);

-- dim 02/10/2011 	Hamilton 	  GALLES 	 - FIDJI         66 - 0
INSERT INTO match VALUES (DEFAULT, '02-10-2011', 8);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 16, 9, 9, 1, 0),
       (currval('seqmatch'), 20, 0, 0, 0, 0);




-- Quarts de finale

-- sam 8/10/2011       Wellington         IRLANDE         - GALLES      10 - 22
INSERT INTO match VALUES (DEFAULT, '08-10-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 11, 1, 1, 1, 0),
       (currval('seqmatch'), 16, 3, 2, 1, 0);

-- sam 8/10/2011       Auckland         ANGLETERRE         - FRANCE      12 - 19
INSERT INTO match VALUES (DEFAULT, '08-10-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 6, 2, 1, 0, 0),
       (currval('seqmatch'), 2, 2, 0, 2, 1);

-- dim 9/10/2011       Wellington        AFRIQUE DU SUD        - AUSTRALIE     9 - 11
INSERT INTO match VALUES (DEFAULT, '09-10-2011', 4);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 19, 0, 0, 2, 1),
       (currval('seqmatch'), 12, 1, 0, 2, 0);

-- dim 9/10/2011       Auckland       NOUVELLE-ZELANDE        - ARGENTINE    33 - 10
INSERT INTO match VALUES (DEFAULT, '09-10-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 1, 2, 1, 7, 0),
       (currval('seqmatch'), 8, 1, 1, 1, 0);




-- Demi-Finales

-- sam 15/10/2011       Auckland         GALLES         - FRANCE      8 - 9
INSERT INTO match VALUES (DEFAULT, '15-10-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 16, 1, 0, 1, 0),
       (currval('seqmatch'), 2, 0, 0, 3, 0);

-- dim 16/10/2011       Auckland         AUSTRALIE         - NOUVELLE-ZELANDE      6 - 20
INSERT INTO match VALUES (DEFAULT, '16-10-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 12, 0, 0, 1, 1),
       (currval('seqmatch'), 1, 1, 0, 4, 1);




-- 3eme place PLAY-OFF

-- ven 21/10/2011       Auckland         GALLES         - AUSTRALIE        18 - 21
INSERT INTO match VALUES (DEFAULT, '21-10-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 16, 2, 1, 2, 0),
       (currval('seqmatch'), 12, 2, 1, 2, 1);




-- FINAL

-- dim 23/10/2011       Auckland         FRANCE         - NOUVELLE-ZELANDE         7 - 8
INSERT INTO match VALUES (DEFAULT, '23-10-2011', 9);
INSERT INTO joue VALUES 
       (currval('seqmatch'), 2, 1, 1, 0, 0),
       (currval('seqmatch'), 1, 1, 0, 1, 0);




/* Différentes réponses à des questions sous forme de lignes de commandes permettant la récupération de 
certaines informations mêlées (Jointures) */

-- Question 1
SELECT nat_nom AS "Nations ReprÃ©sentÃ©es" FROM nation 
	ORDER BY nat_nom; 

--Question 2
SELECT nat_poule AS "Poule", nat_abr AS "AbrÃ©viation" FROM nation
	ORDER BY nat_poule, nat_ABR;

--Question 3
SELECT mat_date, nat_poule, nat_essai, nat_trans, nat_penal, nat_drop FROM joue j, match m, nation n
	WHERE j.mat_id=m.mat_id AND j.nat_id=n.nat_id AND nat_poule='A' AND mat_date < '08-10-2011'
	ORDER BY mat_date;

--Quesion 4
SELECT mat_date AS "Date", n1.nat_nom AS "Equipe", j1.nat_essai, j1.nat_trans, j1.nat_penal, j1.nat_drop, n2.nat_nom AS "Adversaire", j2.nat_essai, j2.nat_trans, j2.nat_penal, j2.nat_drop  
	FROM joue j1, joue j2, nation n1, nation n2, match m
	WHERE j1.mat_id=m.mat_id AND j2.mat_id=m.mat_id 
	      AND j1.nat_id=n1.nat_id AND j2.nat_id=n2.nat_id 
	      AND n1.nat_nom='Nouvelle-Zelande' AND mat_date < '08-10-2011' AND n2.nat_nom!='Nouvelle-Zelande'
	ORDER BY mat_date;

--Question 5
SELECT SUM(5*(nat_essai)+2*(nat_trans)+3*(nat_penal)+3*(nat_drop)) AS "Nombre total de points marquÃ©s" FROM joue;

--Question 6
SELECT nat_nom AS "Equipe", SUM(5*(j.nat_essai)+2*(j.nat_trans)+3*(j.nat_penal)+3*(j.nat_drop)) AS "Total points marquÃ©s"
	FROM joue j, nation n, match m
	WHERE j.mat_id=m.mat_id 
	      AND j.nat_id=n.nat_id
	GROUP BY nat_nom
	ORDER BY nat_nom;

--Question 7
SELECT m.mat_id AS "NÂ° Match", mat_date AS "Date",(n1.nat_nom,n2.nat_nom) AS "Equipe", (    (5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop))::float+
(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop))::float)/2 AS "Nombre moyen points marquÃ©s" 
	FROM joue j1, joue j2, nation n1, nation n2, match m
	WHERE j1.mat_id=m.mat_id AND j2.mat_id=m.mat_id 
	      AND j1.nat_id=n1.nat_id AND j2.nat_id=n2.nat_id 
	      AND n1.nat_nom>n2.nat_nom
	ORDER BY mat_id;

-- Question 8
SELECT  n1.nat_poule AS "Poule", mat_date AS "Date", (n1.nat_nom,n2.nat_nom) AS "Equipe", (    (5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop))::float+
(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop))::float)/2 AS "Nombre moyen points marquÃ©s" 
	FROM joue j1, joue j2, nation n1, nation n2, match m
	WHERE j1.mat_id=m.mat_id AND j2.mat_id=m.mat_id 
	      AND j1.nat_id=n1.nat_id AND j2.nat_id=n2.nat_id 
	      AND n1.nat_nom>n2.nat_nom
	      AND n1.nat_poule=n2.nat_poule
	      AND mat_date < '08-10-2011'
	ORDER BY n1.nat_poule;


SELECT nat_poule, CAST(AVG(5*(j.nat_essai)+2*(j.nat_trans)+3*(j.nat_penal)+3*(j.nat_drop)) AS DECIMAL(4,2) ) AS "Nombre moyen de points marquÃ©s"
	FROM nation n, joue j, match m
	WHERE j.nat_id=n.nat_id AND j.mat_id=m.mat_id AND  mat_date < '08-10-2011'
	GROUP BY nat_poule
	ORDER BY nat_poule;


-- Question 9
SELECT nat_nom AS "Equipe", SUM((nat_essai>3)::Integer) AS "Point(s) offensif(s)" FROM nation n, joue j, match m
      WHERE n.nat_id=j.nat_id AND m.mat_id=j.mat_id AND mat_date < '08-10-2011'
      GROUP BY nat_nom
      ORDER BY nat_nom;


--Question 10
SELECT nat_nom AS "Equipe", SUM((5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)>
(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop)))::Integer) AS "Victoire(s)" 
      FROM nation n, joue j1, joue j2, match m
      WHERE n.nat_id=j1.nat_id AND m.mat_id=j1.mat_id AND j1.mat_id=j2.mat_id
      AND j1.nat_id!=j2.nat_id
      GROUP BY nat_nom
      ORDER BY nat_nom;


--Question 11
CREATE VIEW classementP AS 

SELECT nat_nom AS "Equipe", SUM(

(
(4*
(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)>(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop)))
::Integer)+
(2*
(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)=(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop)))
::Integer)+
+(0*
(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)<(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop)))
::Integer)+
((1*(j1.nat_essai)>3)::Integer)+
(((5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)<5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop))
AND
(((5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop))-(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)))<8))
::Integer)
)

) AS Points 
      FROM nation n, joue j1, joue j2, match m
      WHERE n.nat_id=j1.nat_id AND m.mat_id=j1.mat_id AND j1.mat_id=j2.mat_id
      AND j1.nat_id!=j2.nat_id AND n.nat_poule='A' AND mat_date < '08-10-2011'
      GROUP BY nat_nom
      ORDER BY Points DESC;

SELECT * FROM classementP;



-- Question 12
CREATE VIEW classementPoule AS 

SELECT nat_poule AS Poule, nat_nom AS Equipe, SUM(
(
(4*
(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)>(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop)))
::Integer)+
(2*
(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)=(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop)))
::Integer)+
+(0*
(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)<(5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop)))
::Integer)+
((1*(j1.nat_essai)>3)::Integer)+
(((5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)<5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop))
AND
(((5*(j2.nat_essai)+2*(j2.nat_trans)+3*(j2.nat_penal)+3*(j2.nat_drop))-(5*(j1.nat_essai)+2*(j1.nat_trans)+3*(j1.nat_penal)+3*(j1.nat_drop)))<8))
::Integer)
)

) AS Points 
      FROM nation n, joue j1, joue j2, match m
      WHERE n.nat_id=j1.nat_id AND m.mat_id=j1.mat_id AND j1.mat_id=j2.mat_id
      AND j1.nat_id!=j2.nat_id AND mat_date < '08-10-2011' 
      GROUP BY nat_poule, nat_nom
      ORDER BY nat_poule, Points DESC;

SELECT * FROM classementPoule;
   
SELECT p.Poule , p.Equipe , p.points
FROM (SELECT Poule, MAX(Points) AS maximum FROM classementPoule GROUP BY Poule)premierPoule, classementPoule p
WHERE  p.Poule=premierPoule.Poule
AND p.points=premierPoule.maximum;


